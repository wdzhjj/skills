## mysql相关

#### 查询速度
		 编写查询之前要明白，真正重要的是响应时间。
		 查询如果是一个任务，由一系列子任务组成，每个子任务会消耗一定的时间
		 优化查询就是优化子任务，要么消除其中一些子任务，要么减少子任务的执行次数，要么让子任务运行的更快
		 查询需要在不同的地方花费时间。包括网络、CPU计算、生成统计信息和执行计划、锁等待等
		
		 1、确认应用是否在检索大量超过需要的数据。（访问太多行或者太多列）
		 2、确认MYSQL服务器是否在分析大量超过需要的数据行
		 3、重复查询相同的数据
		 
		 一般情况下MYSQL能使用一下三种方式应用WHERE条件
			* 在索引中使用where条件来过滤不匹配的记录，在存储引擎层完成
			* 使用索引覆盖扫描来返回记录，直接从索引中过滤不需要的记录并返回命中的结果
			* 从数据表中返回数据，然后过滤不满足条件的记录。在mysql服务器层完成，mysql需要先从数据表中读出记录然后过滤

### 重构查询
		*一个复杂查询还是多个简单查询
			考虑是否需要将一个复杂查询分成多个简单查询
		*切分查询	
			有时需要将大查询切分成小查询，只完成一小部分，每次只返回一小部分查询结果
			如大量的数据删除就可以分批次删除，也可将服务器上原本的一次性压力分散到时间段中，降低对服务器的影响
		*分解关联查询
			优势:
				1、让缓存效率更高
				2、查询分解后，执行单个查询可以减少锁的竞争
				3、在应用层做关联，更容易对数据库进行拆分，更容易高性能、可扩展
				4、查询本身的效率也可能有所提升
				5、减少冗余记录的查询
				6、相当于在应用中实现了哈希关联、而不是使用mysql嵌套循环关联。
				
#### 查询缓存
		在解析一个查询语句之前，如果查询缓存是打开的，那么MYSQL会优先检查这个查询是否命中查询缓存中的数据
		这个检查是通过一个对大小写敏感的hash值来判定的。如果权限没有问题，mysql会跳过所有其他阶段，直接从缓存中拿到
		结果并返回给客户端
		
#### 查询优化处理
		语法解析器和预处理
			Mysql通过关键字将SQL语句进行解析，并生成一颗对应的'解析书'
			Mysql解析器将使用Mysql语法规则验证和解析查询
		查询优化器
			一条查询有多种执行方式，最后都返回相同的结果。优化器的作用是找到这其中最好的执行计划
			show status like 'last_query_cost';
				会返回valuie值表示需要多少个数据页的随机查找才能完成上面的查询
				根据表或者索引的页面个数、索引的基数、索引和数据行的长度、索引分布情况
				
#### 索引
		索引的类型
			B-Tree 索引
				如果没有特别指明类型，多半是B-Tree索引，用B-Tree数据结构来存储数据
			
			限制
				*如果不是按照索引的最左列开查找，则无法使用索引。
				*不能跳过索引中的列
				*如果查询中有某个列的查询范围，则其右边的所有列都无法使用索引优化查找

			哈希索引
				基于哈希表实现，只有精确匹配索引所有列的查询才有效
			限制
				* 哈希索引只包含哈希值和行指针，而不存储字段值，所以不能使用索引中的值来避免读行
				* 哈希索引数据并不是按照索引值顺序存储的，所以也就无法用于排序
				* 哈希索引页不支持部分索引列匹配查找，因为哈希索引始终是使用索引列的全部内容来计算哈希值的
				* 只支持等值的比较查询
				* 访问哈希索引的数据非常快，除非有很多哈希冲突
				* 如果哈希冲突很多的话，一些索引维护操作的代价也会很高。



























		